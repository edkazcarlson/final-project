(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{127:function(e,t,n){e.exports=n(172)},132:function(e,t,n){},172:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(24),s=n.n(o),i=(n(132),n(3)),l=n(5),c=n(19),u=n(9),d=n(8),m=(n(56),n(117)),h=n(25),y=n(44),p=n.n(y),f=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={currentStory:{},currentStoryStatus:{}},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;p.a.get("/getcurstory").then((function(t){"nostory"===t.data.status?console.log("NO STORY!"):e.setState({currentStory:{}})}))}},{key:"jumpToStory",value:function(e){this.props.setCurrentInProgressStory(e),window.open("/inProgressStory","_self")}},{key:"render",value:function(){return r.a.createElement("div",{className:"App",style:{display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"center"}},r.a.createElement("h1",{className:"title"},"One Word Story"),r.a.createElement("br",null),r.a.createElement("a",{style:{color:"#ba68c8"},className:"content",href:"/contribute"},"Contribute"),r.a.createElement("br",null),r.a.createElement("div",{className:"lowPriority"},"ICON MADE BY ICONKING FROM WWW.FREEICONS.IO"))}}]),n}(r.a.Component),g=n(31),v=n(208),E=n(209),b=n(210),S=n(211),w=n(213),k=n(212),O=n(206),C=n(118),j=n(203),I=n(67),x=new g.a,N=Object(C.a)({spacing:8,palette:{type:"dark",primary:{main:"#7e57c2"},secondary:{main:"#ba68c8"}}}),P=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={storyLength:null,firstWord:"",frequency:""},a}return Object(l.a)(n,[{key:"createStory",value:function(e){var t=this;console.log(this.state.frequency.value),e.preventDefault(),this.valid()&&fetch("/currentUser").then((function(e){return e.json()})).then((function(e){p.a.post("/addstory",{author:e.user,storylength:t.state.storyLength,storyfirstword:t.state.firstWord.trim(),skip:t.state.frequency,storyType:document.querySelector('input[name="storyType"]:checked').value}).then((function(t){new I.a(t.data._id,x).whenSynced.then((function(){console.log("loaded data from indexed db: "+t)})),x.getArray(t.data._id).insert(0,[{word:t.data.listofwords[0],user:e.user}]),alert("Story created successfully!")}))}))}},{key:"setStoryLength",value:function(e){this.setState({storyLength:e.target.value})}},{key:"setfirstWord",value:function(e){this.setState({firstWord:e.target.value})}},{key:"setFrequency",value:function(e){this.setState({frequency:e.target.value})}},{key:"render",value:function(){var e=this;return r.a.createElement(j.a,{theme:N},r.a.createElement("div",{className:"App"},r.a.createElement("h1",{className:"subtitle"},"Create Story"),r.a.createElement("br",null),r.a.createElement("form",null,r.a.createElement(E.a,{style:{margin:N.spacing(1)},id:"storylength",label:"Story length",type:"number",placeholder:"Story length",variant:"filled",className:"storyInput",margin:"normal",InputLabelProps:{shrink:!0},value:this.state.storyLength,onChange:function(t){e.setStoryLength(t)}}),r.a.createElement(E.a,{style:{margin:N.spacing(1)},id:"storyfirstword",label:"First word of story",type:"text",placeholder:"First word of story",variant:"filled",className:"storyInput",margin:"normal",InputLabelProps:{shrink:!0},value:this.state.firstWord,onChange:function(t){e.setfirstWord(t)}}),r.a.createElement("br",null),r.a.createElement(E.a,{style:{margin:N.spacing(1)},id:"skip",label:"Repeat frequency",type:"number",placeholder:"Repeat frequency",helperText:"How many turns users must wait before recontributing.",variant:"filled",className:"storyInput",margin:"normal",InputLabelProps:{shrink:!0},value:this.state.frequency,onChange:function(t){e.setFrequency(t)}}),r.a.createElement("br",null),r.a.createElement(k.a,{component:"inputlength",margin:"normal"},r.a.createElement(O.a,{component:"legend"},"Choose how users can contribute"),r.a.createElement(S.a,{name:"storyType"},r.a.createElement(w.a,{style:{color:"rgba(255, 255, 255, 87)"},value:"word",control:r.a.createElement(b.a,null),label:"One word at a time"}),r.a.createElement(w.a,{style:{color:"rgba(255, 255, 255, 87)"},value:"phrase",control:r.a.createElement(b.a,null),label:"Short phrases"}))),r.a.createElement("br",null),r.a.createElement(v.a,{style:{fontSize:"16px"},variant:"contained",onClick:function(t){e.createStory(t)}},"Create Story"),r.a.createElement("br",null)),r.a.createElement("br",null),r.a.createElement("a",{style:{color:"#ba68c8"},className:"content",href:"/"},"Return to homepage")))}},{key:"valid",value:function(){var e=document.querySelectorAll(".storyInput");console.log(this),console.log(e),console.log(this.state.storyLength);var t=document.querySelector('input[name="storyType"]:checked').value;if(0<parseInt(this.state.storyLength)&&parseInt(this.state.storyLength)<100)if("word"===t&&this.state.firstWord.trim()!==this.state.firstWord.replace(/ /g,""))alert("Please enter a word or switch the story type to phrase.");else if("phrase"===t&&this.state.firstWord.length>200)alert("Please enter a phrase less than 200 characters.");else{if(0<=parseInt(this.state.frequency)&&parseInt(this.state.frequency)<parseInt(this.state.storyLength))return!0;alert("Please choose a skip value between 0 and the maximum story length.")}else alert("Please choose a story length between 0 and 100 words.");return!1}}]),n}(r.a.Component),T=n(23),W=Object(C.a)({spacing:8,palette:{type:"dark",primary:{main:"#7e57c2"},secondary:{main:"#ba68c8"}}});function L(e){var t=r.a.useState(!1),n=Object(T.a)(t,2),a=n[0],o=n[1];function s(e){window.open(e,"_self")}return r.a.useEffect((function(){fetch("/currentUser").then((function(e){return e.json()})).then((function(e){console.log(e),o(null!==e.user)}))})),r.a.createElement(j.a,{theme:W},r.a.createElement("div",{className:"TopBar",style:{marginBottom:"10px",display:"flex",justifyContent:"space-between"}},r.a.createElement("div",null,[{name:"Home Page",url:"/"},{name:"Browse Completed Stories",url:"/completedStories"},{name:"Make a Story",url:"/CreateStory"},{name:"Contribute",url:"/contribute"}].map((function(e){return r.a.createElement(v.a,{key:e.name,style:{fontSize:"16px"},onClick:function(){s(e.url)},variant:"contained"},e.name)}))),a?r.a.createElement(v.a,{style:{fontSize:"16px"},variant:"contained",onClick:function(){fetch("/logOut",{method:"POST"}).then((function(){window.open("/","_self")}))}},"Log out"):r.a.createElement(v.a,{style:{fontSize:"16px"},variant:"contained",onClick:function(){s("/login")}},"Log in")))}var A,D,_=n(207),q=Object(C.a)({spacing:8,palette:{type:"dark",primary:{main:"#7e57c2"},secondary:{main:"#ba68c8"}}}),V=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={demoStories:[]},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;fetch("/getallcompleted").then((function(e){return e.json()})).then((function(t){t.stories.forEach((function(t){console.log(t),console.log(t.votes),t.votes=e.getVotes(t.votes),console.log(t.votes)})),t.stories.sort((function(e,t){return t.votes-e.votes})),e.setState({demoStories:t.stories})}))}},{key:"render",value:function(){var e=this;return r.a.createElement(j.a,{theme:q},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flexWrap:"wrap"}},r.a.createElement("h1",{className:"title"},"Completed Stories"),this.state.demoStories.map((function(t){return r.a.createElement(_.a,{style:{margin:q.spacing(1),padding:q.spacing(2),width:400},onClick:function(){return e.click(t._id)}},r.a.createElement("div",{style:{cursor:"pointer"}},r.a.createElement("div",{className:"subtitle"},t.title),r.a.createElement("div",{className:"lowPriority"},"".concat(t.votes," VOTES"))),r.a.createElement("div",{className:"content"},e.getFirstWords(t.listofwords)))}))))}},{key:"getVotes",value:function(e){var t=0;for(var n in e)t+=e[n].value;return t}},{key:"getFirstWords",value:function(e){var t="";return e.forEach((function(e,n){n<3?t+="".concat(e," "):3===n&&(t+="...")})),t}},{key:"click",value:function(e){this.props.setCurrentStory(e),setTimeout((function(){return window.open("/completeStory?id="+e,"_self")}),10)}}]),n}(r.a.Component),R=n(114),U=n.n(R),F=n(115),M=n.n(F),H=Object(C.a)({spacing:8,palette:{type:"dark",primary:{main:"#7e57c2"},secondary:{main:"#ba68c8"}}}),B=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={story:null,chosenVote:null,isAuthor:!1},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=new URLSearchParams(window.location.search).get("id");p.a.post("/getbyID",{_id:t}).then((function(t){var n=new g.a;new I.a(t.data._id,n).whenSynced.then((function(){console.log(t.data.story),e.setState({story:t.data.story}),fetch("/currentUser").then((function(e){return e.json()})).then((function(e){return e.user})).then((function(n){n==t.data.story.contributors[0]&&e.setState({isAuthor:!0}),t.data.story.votes.forEach((function(t){t.id===n&&e.setState({chosenVote:t.value})}))})),console.log(e.state)}))}))}},{key:"render",value:function(){var e=this;if(null!=this.state.story){var t=new Date(this.state.story.timeEnd);console.log(this.state.story.timeEnd-this.state.story.timeStart);var n=this.state.story.timeEnd-this.state.story.timeStart;return r.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},r.a.createElement(j.a,{theme:H},r.a.createElement(_.a,{style:{minHeight:400,minWidth:400,padding:H.spacing(2),display:"flex",flexDirection:"column",flexWrap:"wrap"}},r.a.createElement("div",null,r.a.createElement("h1",{className:"title",id:"title",style:{textAlign:"center",color:"white"}},this.state.story.title),this.state.isAuthor?r.a.createElement(v.a,{id:"editTitle",variant:"contained",onClick:this.editTitle.bind(this)},"edit title"):null,r.a.createElement("p",{style:{color:"white"}},this.state.story.listofwords.join(" ")+".")),r.a.createElement("div",{style:{marginRight:"10px"}},r.a.createElement(U.a,{style:{color:1===this.state.chosenVote?H.palette.secondary.main:"white"},onClick:function(){return e.setVote(1)}}),r.a.createElement(M.a,{style:{color:-1===this.state.chosenVote?H.palette.secondary.main:"white"},onClick:function(){return e.setVote(-1)}}),r.a.createElement("p",{className:"lowPriority"},"Points: ",this.getVotes(this.state.story.votes)),r.a.createElement("p",{className:"lowPriority"},"Author: ",this.state.story.contributors[0]),r.a.createElement("p",{className:"lowPriority"},"Story Type: ",this.state.story.storyType),r.a.createElement("em",{className:"lowPriority"},"Finished ",t.toLocaleDateString()," at ",t.toLocaleTimeString()," "),r.a.createElement("br",null),r.a.createElement("em",{className:"lowPriority"},"Took",Math.floor(n/36e5)>0?Math.floor(n/36e5)+"hour"+(1==Math.floor(n/36e5)?"":"s"):""," ",Math.floor(n/6e4)%60," minute",Math.floor(n/6e4)%60==1?"":"s"," to complete.")))))}return null}},{key:"editTitle",value:function(e){e.preventDefault();var t=document.querySelector("#editTitle");console.log(t.value,"edit title"==t.value),"edit title"==t.value?(t.value="save",document.querySelector("#title").contentEditable=!0):(t.value="edit title",p.a.post("/edittitle",{title:document.querySelector("#title").innerText,_id:this.state.story._id}).then((function(e){console.log("EDITED!")})),document.querySelector("#title").contentEditable=!1)}},{key:"setVote",value:function(e){console.log(this.state.chosenVote),console.log(e),this.state.chosenVote===e?(this.setState({chosenVote:0}),e=0):this.setState({chosenVote:e}),console.log("Voting!");var t=this,n=t.state.story.votes;fetch("/currentUser").then((function(e){return e.json()})).then((function(a){n.map((function(e){return e.id})).includes(a.user)?t.state.story.votes[t.state.story.votes.indexOf(t.state.story.votes.find((function(e){return e.id===a.user})))]={id:a.user,value:e}:t.state.story.votes.push({id:a.user,value:e}),console.log(t.state.story.votes),p.a.post("/changeVote",{_id:t.state.story._id,votes:t.state.story.votes}).then((function(e){t.forceUpdate(),console.log("reached here")}))}))}},{key:"getVotes",value:function(e){var t=0;for(var n in e)t+=e[n].value;return t}}]),n}(r.a.Component),G=Object(C.a)({spacing:8,palette:{type:"dark",primary:{main:"#7e57c2"},secondary:{main:"#ba68c8"}}}),z=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),a=t.call(this,e),e.isLogin?a.buttonClick=function(e){a.login(e)}:a.buttonClick=function(e){a.register(e)},a.state={username:"",password:""},a}return Object(l.a)(n,[{key:"login",value:function(e){console.log("login page button clicked"),console.log(this),e.preventDefault();var t={username:this.state.username,password:this.state.password},n=JSON.stringify(t);return fetch("/login",{method:"POST",body:n,headers:{"Content-Type":"application/json"}}).then((function(e){if(!0!==e.redirected)return e.json();window.open(e.url,"_self")})).then((function(e){var t=document.getElementById("errormsg");"password"===e.error.toString()?t.innerText="Password Incorrect":t.innerText="Username not found"})),!1}},{key:"register",value:function(e){console.log("register page button clicked"),e.preventDefault();var t={username:this.username,password:this.password},n=JSON.stringify(t);return fetch("/register",{method:"POST",body:n,headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){"found"===e.code?alert("This username already exists"):window.open("/","_self")})),!1}},{key:"setUsername",value:function(e){this.setState({username:e.target.value}),this.checkIfFieldsEmpty()}},{key:"setPassword",value:function(e){this.setState({password:e.target.value}),this.checkIfFieldsEmpty()}},{key:"checkIfFieldsEmpty",value:function(){return""===this.username||""===this.password?(document.querySelector("#signin").disabled=!0,!0):(document.querySelector("#signin").disabled=!1,!1)}},{key:"render",value:function(){var e=this;return r.a.createElement(j.a,{theme:G},r.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"}},r.a.createElement("p",{id:"errormsg"}),r.a.createElement("div",{className:"container",style:{margin:"10px",display:"flex",justifyContent:"space-around",alignItems:"center"}},r.a.createElement("div",null,r.a.createElement("p",{id:"errormsg"}),r.a.createElement(E.a,{style:{margin:G.spacing(1)},id:"username",label:"Username",type:"text",placeholder:"Username",variant:"filled",className:"loginField",margin:"normal",InputLabelProps:{shrink:!0},value:this.state.username,onChange:function(t){e.setUsername(t)}}),r.a.createElement("br",null),r.a.createElement(E.a,{style:{margin:G.spacing(1)},id:"password",label:"Password",type:"password",placeholder:"Password",variant:"filled",className:"loginField",margin:"normal",InputLabelProps:{shrink:!0},value:this.state.password,onChange:function(t){e.setPassword(t)}}),r.a.createElement("br",null),r.a.createElement(v.a,{style:{margin:G.spacing(1)},id:"signin",onClick:this.buttonClick,variant:"contained"},this.props.isLogin?"Login":"Signup"),this.props.isLogin?r.a.createElement("div",null,r.a.createElement("p",{className:"lowPriority"},"DON'T HAVE AN ACCOUNT?"),r.a.createElement("a",{style:{color:"#ba68c8"},href:"/register"},r.a.createElement("p",{className:"content"},"Sign Up"))):"",r.a.createElement("div",{className:"lowPriority"},r.a.createElement("p",null,"OR LOG IN WITH")),r.a.createElement("div",{style:{justifyContent:"center"}},r.a.createElement("a",{href:"/auth/github",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"img/GitHub_Logo_White.png",alt:"GitHub logo",style:{width:250,height:100}})))))))}}]),n}(a.Component),J=n(119),Y=n(120),K=new g.a,Q=Object(C.a)({spacing:8,palette:{type:"dark",primary:{main:"#7e57c2"},secondary:{main:"#ba68c8"}}}),X=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={listOfWords:[],maxWords:-1,title:"",id:-1,curWordCount:0,isWordType:null,contributors:null,skip:0},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;fetch("/currentUser").then((function(e){return e.json()})).then((function(e){D=e.user})),p.a.get("/getcurstory").then((function(t){if("nostory"===t.data.status)window.open("/createstory","_self");else{e.setState({isWordType:"word"===t.data.storyType}),new I.a(t.data._id,K).whenSynced.then((function(){console.log("loaded data from indexed db")}));new J.a(t.data._id,K),new Y.a("wss://demos.yjs.dev",t.data._id,K);A=K.getArray(t.data._id),e.setState({listOfWords:t.data.listofwords,maxWords:t.data.maxwords,title:t.data.title,id:t.data._id,curWordCount:t.data.listofwords.length,contributors:t.data.contributors,skip:t.data.skip})}A.observe((function(t){console.log("CONTRIBUTORS: ",A.toArray().map((function(e){return e.user}))),e.setState({listOfWords:A.toArray().map((function(e){return e.word})),curWordCount:A.toArray().length,contributors:A.toArray().map((function(e){return e.user}))},(function(){this.state.maxWords==A.length?(alert("Story is complete!"),window.open("/","_self")):console.log(A.toArray())}))}))}))}},{key:"addWord",value:function(e){e.preventDefault();var t=document.querySelector("#nextword").value.trim();t.split(" ").length>1&&this.state.isWordType?alert("Cannot upload multiple words for this story"):this.enoughEntries()?(A.push([{word:t,user:D}]),document.querySelector("#nextword").value="",p.a.post("/addword",{id:this.state.id,word:t,contributors:A.toArray().map((function(e){return e.user}))}).then((function(e){console.log("Pushed new word to database")}))):alert("Wait your turn!")}},{key:"render",value:function(){var e=0;return void 0!==A&&(e=-1===A.toArray().map((function(e){return e.user})).lastIndexOf(D)?0:this.state.skip-(A.length-A.toArray().map((function(e){return e.user})).lastIndexOf(D)-1),console.log("Length",A.length),console.log("last index",A.toArray().map((function(e){return e.user})).lastIndexOf(D)),console.log("Skip: ",this.state.skip),console.log("skipTry: ",e)),r.a.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},r.a.createElement("h1",{className:"title"},this.state.title),r.a.createElement(j.a,{theme:Q},r.a.createElement("div",{className:"subtitle"},this.state.listOfWords.map((function(e){return r.a.createElement("span",null,e," ")})),r.a.createElement("br",null),r.a.createElement("form",null,r.a.createElement(E.a,{style:{margin:Q.spacing(1)},id:"nextword",label:"Next input",type:"text",placeholder:"enter a word or phrase",variant:"filled",margin:"normal",InputLabelProps:{shrink:!0}}),r.a.createElement("input",{style:{visibility:"hidden",height:"0px",width:"0px"},type:"submit",onClick:this.addWord.bind(this)})),r.a.createElement("br",null),r.a.createElement("h2",{className:"content"},void 0!==A?e<0?0:e:""," more users must contribute before you can."),r.a.createElement("h2",{className:"lowPriority"},"THERE ARE ",this.state.maxWords-this.state.curWordCount," ",this.state.isWordType?"WORDS":"PHRASES"," REMAINING."))))}},{key:"enoughEntries",value:function(){var e=-1===A.toArray().map((function(e){return e.user})).lastIndexOf(D)?0:this.state.skip-(A.length-A.toArray().map((function(e){return e.user})).lastIndexOf(D)-1);return console.log("Length",A.length),console.log("last index",A.toArray().map((function(e){return e.user})).lastIndexOf(D)),console.log(this.state.skip),console.log("posValue: ",e),e<=0}}]),n}(r.a.Component),Z=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).setCurrentStory=function(e){a.setState({currentStoryID:e})},a.setCurrentInProgressStory=function(e){a.setState({inProgressStoryID:e})},a.state={currentStoryID:-1,inProgressStoryID:-1},a.setCurrentStory=a.setCurrentStory.bind(Object(c.a)(a)),a.setCurrentInProgressStory=a.setCurrentInProgressStory.bind(Object(c.a)(a)),a}return Object(l.a)(n,[{key:"render",value:function(){return r.a.createElement(m.a,null,r.a.createElement(L,null),r.a.createElement(h.a,{exact:!0,path:"/"},r.a.createElement(f,{setCurrentInProgressStory:this.setCurrentInProgressStory})),r.a.createElement(h.a,{exact:!0,path:"/login"},r.a.createElement(z,{isLogin:!0})),r.a.createElement(h.a,{path:"/register"},r.a.createElement(z,{isLogin:!1})),r.a.createElement(h.a,{path:"/createstory"},r.a.createElement(P,null)),r.a.createElement(h.a,{path:"/contribute"},r.a.createElement(X,null)),r.a.createElement(h.a,{path:"/completedStories"},r.a.createElement(V,{setCurrentStory:this.setCurrentStory,id:this.state.currentStoryID})),r.a.createElement(h.a,{path:"/completeStory"},r.a.createElement(B,{id:this.state.currentStoryID})))}}]),n}(r.a.Component);s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Z,null)),document.getElementById("root"))},56:function(e,t,n){}},[[127,1,2]]]);
//# sourceMappingURL=main.7c8b8980.chunk.js.map